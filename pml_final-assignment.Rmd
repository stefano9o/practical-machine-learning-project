---
title: "pml_final-assignment"
author: "Stefano Galeano"
date: "9/14/2017"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# PML - Final assignment

## Introduction

## Exploratory data analysis

```{r, message=TRUE, warning=TRUE, include=FALSE}
trainUrl <- 'https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv'
testUrl <- 'https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv'

download.file(url = trainUrl,destfile = 'data/train.csv')
download.file(url = testUrl,destfile = 'data/test.csv')
train <- read.csv('data/train.csv', header = TRUE, stringsAsFactors = FALSE, na.strings = c("NA","#DIV/0!",""))
test <- read.csv('data/test.csv', header = TRUE, stringsAsFactors = FALSE, na.strings = c("NA","#DIV/0!",""))
```

```{r}
features.accel <- grep(pattern = ".*accel.*",x = names(train))
features.gyros <- grep(pattern = ".*gyros.*",x = names(train))
features.roll <- grep(pattern = ".*roll.*",x = names(train))
features.pitch <- grep(pattern = ".*pitch.*",x = names(train))
features.yam <- grep(pattern = ".*yaw.*",x = names(train))

outcome <- which(names(train) == "classe")

train.sel <- train[c(outcome,features.accel,features.gyros,features.roll,features.pitch,features.yam)]
test.sel <- test[c(features.accel,features.gyros,features.roll,features.pitch,features.yam)]

train.sel$classe <- as.factor(train.sel$classe)
```

```{r}
ncol(train.sel)

naFeatureIndexes <- sapply(names(train.sel),function(featureName){
        sum(is.na(train.sel[,featureName]))/nrow(train.sel) > .95
})
length(which(naFeatureIndexes))


train.sel[,naFeatureIndexes] <- NULL

ncol(train.sel)

```

```{r}
library(caret)

train.cor <- cor(train.sel[,-1])
highlyCorrelated <- findCorrelation(train.cor, cutoff=0.75, names = TRUE)
train.sel[,highlyCorrelated] <- NULL

```

```{r}
names(train.sel[,c(1,3,25,28,27)])
plot(train.sel$total_accel_belt,train.sel$accel_belt_y)
plot(train.sel$gyros_dumbbell_z,train.sel$gyros_forearm_z)
plot(train.sel$gyros_forearm_z,train.sel$gyros_forearm_y)
```

```{r}
mod <- lm(total_accel_belt~accel_belt_y, data = train.sel)
plot(mod)

outliers <- which(hatvalues(mod) > 0.0004)
train.sel <- train.sel[-outliers,]
mod <- lm(total_accel_belt~accel_belt_y, data = train.sel)
plot(mod)
```

```{r}
mod <- lm(gyros_dumbbell_z~gyros_forearm_z, data = train.sel)
plot(mod)

outliers <- which(hatvalues(mod) > 0.1)
train.sel <- train.sel[-outliers,]
mod <- lm(total_accel_belt~accel_belt_y, data = train.sel)
plot(mod)
```

```{r}
mod <- lm(gyros_forearm_z~gyros_forearm_y, data = train.sel)
plot(mod)
```

```{r}
names(train.sel[,c(1,3,25,28,27)])
plot(train.sel$total_accel_belt,train.sel$accel_belt_y)
plot(train.sel$gyros_dumbbell_z,train.sel$gyros_forearm_z)
plot(train.sel$gyros_forearm_z,train.sel$gyros_forearm_y)
```

```{r}
library(caret)

set.seed(1234)

fitTre <- train(classe~., data = train.sel, method = "rpart")
fitTre
```
## Conclusion
